<h1>Operation meeting</h1>
<p id="choice_error"></p>

<p>
<table border="1">
  <tr>
    <th></th>
    <% @meeting.roles.each do |role| %>
    <th>
      <%= role.name %>
    </th>
    <% end %>

  </tr>
  <tr>
    <td>Assign Status</td>
    <% @meeting.roles.each do |role| %>
    <td>
    <%=  content_tag(:p, :id => "assign_#{dom_id(role)}") do %>
    
      <%= role.assign.presence || "\t" %>
    <% end %>
    <% if current_user.mymeetings.include? (@meeting) %>
    <%= render @presenter.assign_role(nil, role.id, 'Cancel'), :as => :role %>
    <% end %>

    </td>
    <% end %>


  </tr>
    <% @meeting.members.each do |member| %>
    <% next unless member.status%>
  <tr id=<%= "#{dom_id(member)}" %>>
    <td> 
      <%= member %>
    </td>

    <% @meeting.roles.each do |role| %>
    <td>
      <%=  content_tag(:p, :class => "choice_#{dom_id(role)}") do %>
        <%= @presenter.choice_status(member.id, role.id) %>
      <% end %>
      <%=  content_tag(:p, :class => "assign_#{dom_id(role)}") do %>
        <%= assign_status_for(@meeting, role, member.user.id) %>
      <% end %>      
    <% if current_user.mymeetings.include? (@meeting) %>
      <%= render @presenter.assign_role(member.id, role.id), :as => :role %>
    <% elsif current_user.member? (member) %>

      <%= render @presenter.make_choice(member.id, role.id, true), :as => :choice %>
      <%= render @presenter.make_choice(member.id, role.id, false), :as => :choice %>
    <% end %>

    </td>
    <% end %>


  </tr>

    <% end %>
</table>

</p>
